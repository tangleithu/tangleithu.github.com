<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="中南大学|清华大学软件学院唐磊的博客,主攻软件工程,数据挖掘,这里记录了我的学习，生活和工作"><title>android获取联系人代码 | tanglei's blog|唐磊的个人博客</title><link rel="stylesheet" type="text/css" href="/css/normalize.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/pure-min.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">android获取联系人代码</h1><a id="logo" href="/.">tanglei's blog|唐磊的个人博客</a><p class="description">记录我的学习、生活、工作。</p></div><div id="nav-menu"><a href="/." class="current"><i class="icon-home"> 首页</i></a><a href="/archives/"><i class="icon-archive"> 归档</i></a><a href="/blog/about.html"><i class="icon-about"> 关于</i></a><a href="/atom.xml"><i class="icon-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post post-page"><h1 class="post-title">android获取联系人代码</h1><div class="post-meta">2011-06-28 | <span class="categories">分类于<a href="/categories/coding小工具/"> coding小工具</a></span></div><span data-disqus-identifier="blog/android-get-contacts.html" class="disqus-comment-count"></span><div class="post-content"><p>前面讲的发送短信就这样吧。能发就行了。不考虑啥性能效率的问题的话，就一个for循环就群发了。至于我想象当中的定制的消息的话，就是获取联系人，匹配短信模版，正则替换得到定制的独一无二的短信。现在就是要获取联系人。最简单的方法就是如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleContact</span> <span class="keyword">extends</span> <span class="title">ListActivity</span></span><br><span class="line"></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* </span><br><span class="line">	 * @see android.app.Activity#onCreate(android.os.Bundle)</span><br><span class="line">	 */</span></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span></span><br><span class="line">	</span>&#123;</span><br><span class="line">		<span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">		getContacts();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span><br><span class="line">	 * Author: tl3shi</span><br><span class="line">	 * 下午12:14:35</span><br><span class="line">	 * Discription:</span><br><span class="line">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">getContacts</span><span class="params">()</span></span><br><span class="line">	</span>&#123;</span><br><span class="line">		<span class="comment">// Get a cursor with all people</span></span><br><span class="line">		Cursor c = getContentResolver().query(ContactsContract.CommonDataKinds.Phone.CONTENT_URI, <span class="keyword">null</span>, </span><br><span class="line">				<span class="keyword">null</span>, <span class="keyword">null</span>, </span><br><span class="line">				<span class="keyword">null</span>);</span><br><span class="line">		</span><br><span class="line">		startManagingCursor(c);</span><br><span class="line">		ListAdapter adapter = <span class="keyword">new</span> SimpleCursorAdapter(<span class="keyword">this</span>, </span><br><span class="line">		        android.R.layout.simple_list_item_2, </span><br><span class="line">		        c, </span><br><span class="line">		        <span class="keyword">new</span> String[] &#123;PhoneLookup.DISPLAY_NAME,PhoneLookup._ID&#125; ,</span><br><span class="line">		        <span class="keyword">new</span> <span class="keyword">int</span>[] &#123;android.R.id.text1,android.R.id.text2&#125;); </span><br><span class="line">		setListAdapter(adapter);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下<a href="/wp-content/uploads/2011/06/android-get-contact.jpg"><img src="/wp-content/uploads/2011/06/android-get-contact.jpg" alt="android获取通讯录" title="android获取联系人" width="243" height="325" class="aligncenter size-full wp-image-945"></a></p>
<p>原以为想到，直接将显示的每一个item小的那个字段直接搞成电话号码就行了。现在看来我为啥会那样想呢。。自己手机里的一个联系人有2个电话也是常有的事情啊，那得现实哪个？所以报错啊之类就很正常了。</p>
<p>看看query方法的签名：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Cursor <span class="title">query</span> <span class="params">(Uri uri, String[] projection, String selection, String[] selectionArgs, String sortOrder)</span></span></span><br></pre></td></tr></table></figure>
<p>API如下解释</p>
<p>Query the given URI, returning a Cursor over the result set. </p>
<p>For best performance, the caller should follow these guidelines: </p>
<p>Provide an explicit projection, to prevent reading data from storage that aren&#8217;t going to be used. </p>
<p>Use question mark parameter markers such as &#8216;phone=?&#8217; instead of explicit values in the selection parameter, so that queries that differ only by those values will be recognized as the same for caching purposes. </p>
<p>Parameters</p>
<p><strong>uri ：</strong> The URI, using the content:// scheme, for the content to retrieve.</p>
<p><strong>projection</strong> A list of which columns to return. Passing null will return all columns, which is inefficient.</p>
<p><strong>selection</strong> A filter declaring which rows to return, formatted as an SQL WHERE clause (excluding the WHERE itself). Passing null will return all rows for the given URI.</p>
<p><strong>selectionArgs</strong> You may include ?s in selection, which will be replaced by the values from selectionArgs, in the order that they appear in the selection. The values will be bound as Strings.</p>
<p><strong>sortOrder</strong> How to order the rows, formatted as an SQL ORDER BY clause (excluding the ORDER BY itself). Passing null will use the default sort order, which may be unordered. </p>
<p>Returns</p>
<p>A Cursor object, which is positioned before the first entry, or null</p>
<p>看来我的直接通过那样来获取每个联系人姓名及其手机号码的梦想是泡汤了。还得这样做才行。 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getContact</span><span class="params">()</span></span>&#123;   </span><br><span class="line">     <span class="comment">//获得所有的联系人   </span></span><br><span class="line">    Cursor cur = getContentResolver().query(ContactsContract.Contacts.CONTENT_URI, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);   </span><br><span class="line">    <span class="comment">//循环遍历   </span></span><br><span class="line">    <span class="keyword">if</span> (cur.moveToFirst()) &#123;   </span><br><span class="line">        <span class="keyword">int</span> idColumn  = cur.getColumnIndex(ContactsContract.Contacts._ID);   </span><br><span class="line">           </span><br><span class="line">        <span class="keyword">int</span> displayNameColumn = cur.getColumnIndex(ContactsContract.Contacts.DISPLAY_NAME);   </span><br><span class="line">        do &#123;   </span><br><span class="line">            <span class="comment">//获得联系人的ID号   </span></span><br><span class="line">           String contactId = cur.getString(idColumn);   </span><br><span class="line">           <span class="comment">//获得联系人姓名   </span></span><br><span class="line">           String disPlayName = cur.getString(displayNameColumn);   </span><br><span class="line">           <span class="comment">//查看该联系人有多少个电话号码。如果没有这返回值为0   </span></span><br><span class="line">           <span class="keyword">int</span> phoneCount = cur.getInt(cur   </span><br><span class="line">                    .getColumnIndex(ContactsContract.Contacts.HAS_PHONE_NUMBER));   </span><br><span class="line">           <span class="keyword">if</span>(phoneCount&gt;<span class="number">0</span>)&#123;   </span><br><span class="line">               <span class="comment">//获得联系人的电话号码   </span></span><br><span class="line">               Cursor phones = getContentResolver().query(   </span><br><span class="line">                        ContactsContract.CommonDataKinds.Phone.CONTENT_URI,   </span><br><span class="line">                        <span class="keyword">null</span>,   </span><br><span class="line">                        ContactsContract.CommonDataKinds.Phone.CONTACT_ID   </span><br><span class="line">                                + <span class="string">" = "</span> + contactId, <span class="keyword">null</span>, <span class="keyword">null</span>);   </span><br><span class="line">               <span class="keyword">if</span>(phones.moveToFirst())&#123;   </span><br><span class="line">                   do&#123;   </span><br><span class="line">                       <span class="comment">//遍历所有的电话号码   </span></span><br><span class="line">                       String phoneNumber= phones.getString(phones     </span><br><span class="line">                                .getColumnIndex(ContactsContract.CommonDataKinds.Phone.NUMBER));   </span><br><span class="line">                       System.out.println(phoneNumber);   </span><br><span class="line">                   &#125;<span class="keyword">while</span>(phones.moveToNext());   </span><br><span class="line">               &#125;   </span><br><span class="line">              </span><br><span class="line">           &#125;   </span><br><span class="line">  </span><br><span class="line">           &#125; <span class="keyword">while</span> (cur.moveToNext());   </span><br><span class="line">  </span><br><span class="line">    &#125;   </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>若只想要得到手机号码，在第3个参数上面也说了，加where条件即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Cursor phones = mContext.getContentResolver().query(</span><br><span class="line">                                ContactsContract.CommonDataKinds.Phone.CONTENT_URI,</span><br><span class="line">                                <span class="keyword">null</span>,</span><br><span class="line">                                ContactsContract.CommonDataKinds.Phone.CONTACT_ID</span><br><span class="line">                                                + <span class="string">" = "</span> + contactId +<span class="string">" and "</span>+ContactsContract.CommonDataKinds.Phone.TYPE+<span class="string">"="</span>+ContactsContract.CommonDataKinds.Phone.TYPE_MOBILE, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br></pre></td></tr></table></figure>
</div><div class="tags"><a href="/tags/android获取通讯录/">android获取通讯录</a><a href="/tags/获取联系人信息/">获取联系人信息</a></div><div class="post-nav"><a href="/blog/my-routine-to-sz-tencent.html" class="pre"><i class="icon-previous">深圳实习行程准备</i></a><a href="/blog/android-let-sms-into-sendbox.html" class="next">android将发送短信保存至发件箱代码<i class="icon-next"></i></a></div><div id="disqus_thread"><script>var disqus_shortname = 'hexo-tanglei';
var disqus_identifier = 'blog/android-get-contacts.html';
var disqus_title = 'android获取联系人代码';
var disqus_url = 'http://www.tanglei.name/blog/android-get-contacts.html';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//hexo-tanglei.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="search" name="word" maxlength="20" placeholder="Search" class="search-form-input"/><input type="hidden" name="si" value="http://www.tanglei.name"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="widget-title">分类</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA/">JAVA</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-amp-Ubuntu/">Linux&amp;Ubuntu</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MyLife/">MyLife</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/SoftwareEngineering/">SoftwareEngineering</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Windows/">Windows</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/android/">android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/c/">c++</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/coding小工具/">coding小工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/wordpress/">wordpress</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/业界动态/">业界动态</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/名人名事/">名人名事</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/实习那些事儿/">实习那些事儿</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作那些事儿/">工作那些事儿</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/开开眼界/">开开眼界</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/我不会算法/">我不会算法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/我做站长/">我做站长</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库应用/">数据库应用</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据挖掘/">数据挖掘</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/敲敲代码/">敲敲代码</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/清华大学/">清华大学</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/玩玩手机/">玩玩手机</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/移动领域/">移动领域</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/经验技巧/">经验技巧</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络文摘/">网络文摘</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机图形学/">计算机图形学</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/贵州支教行/">贵州支教行</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/软件0804/">软件0804</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/软件体系结构/">软件体系结构</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/软件学院/">软件学院</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/软件工程/">软件工程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/软件度量及其应用/">软件度量及其应用</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/软件配置管理/">软件配置管理</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/软件项目管理/">软件项目管理</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/软考/">软考</a></li></ul></div><div class="widget"><div class="widget-title">最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/blog/jquery-ajax-post-to-download-a-file.html">jQuery Ajax请求下载文件资源</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/travel-to-northwest-of-China.html">毕业旅行之大西北游</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/codecolorer-adapted-to-highlight.html">将代码高亮插件codecolorer替换为highlight</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/binding-domain-to-plugin-of-mobile-theme.html">给手机主题插件Wptouch绑定单独的域名</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/share-beamer-with-tsinghua-theme.html">分享一个清华主题的beamer模版</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/install-vim-latex-suite-in-mac-osx.html">Mac下安装使用vim插件latex-suite</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/travel-to-vietnam.html">越南10日游记</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/summary-of-year-2014.html">2014年终总结</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/android-airplanemode-auto-switcher-v2.html">飞行模式助手</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/leetcode-summary.html">leetcode总结</a></li></ul></div><div class="widget"><div class="widget-title">最近评论</div><script type="text/javascript" src="//hexo-tanglei.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title">友情链接</div><ul></ul><a href="http://wordpress.tanglei.name/" title="我的wordpress博客" target="_blank">我的wordpress博客</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div></div><div id="footer">© <a href="/." rel="nofollow">tanglei's blog|唐磊的个人博客.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/jquery.min.js?v=0.0.0"></script><script type="text/javascript" src="/js/totop.js?v=0.0.0"></script><script type="text/javascript" src="/js/fancybox.pack.js?v=0.0.0"></script><script type="text/javascript" src="/js/jquery.fancybox.js?v=0.0.0"></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>