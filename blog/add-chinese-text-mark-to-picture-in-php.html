<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="中南大学|清华大学软件学院唐磊的博客,主攻软件工程,数据挖掘,这里记录了我的学习，生活和工作"><title>php图片加文字水印(中文乱码解法方案) | tanglei's blog|唐磊的个人博客</title><link rel="stylesheet" type="text/css" href="/css/normalize.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/pure-min.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">php图片加文字水印(中文乱码解法方案)</h1><a id="logo" href="/.">tanglei's blog|唐磊的个人博客</a><p class="description">记录我的学习、生活、工作。</p></div><div id="nav-menu"><a href="/." class="current"><i class="icon-home"> 首页</i></a><a href="/archives/"><i class="icon-archive"> 归档</i></a><a href="/blog/about.html"><i class="icon-about"> 关于</i></a><a href="/atom.xml"><i class="icon-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post post-page"><h1 class="post-title">php图片加文字水印(中文乱码解法方案)</h1><div class="post-meta">2011-11-17 | <span class="categories">分类于<a href="/categories/PHP/"> PHP</a><a href="/categories/PHP/实习那些事儿/"> 实习那些事儿</a></span></div><span data-disqus-identifier="blog/add-chinese-text-mark-to-picture-in-php.html" class="disqus-comment-count"></span><div class="post-content"><p>昨天接到一个新需求，给图片加文字。用于感恩节还是圣诞节之类的哦。也就是图片加文字水印。网上查了下，很多相关的内容。英文是很好解决滴，不过中文可搞死我了。</p>
<p>大致就是：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$name</span>=<span class="string">'郁闷aaaaaa'</span>;<span class="comment">//要加的水印文字</span></span><br><span class="line"><span class="variable">$font</span> = <span class="string">'./simhei.ttf'</span>;<span class="comment">//水印字体，Windows\Fonts有，乱码跟这个也有关系</span></span><br><span class="line"><span class="variable">$im</span> = imagecreatefrompng(<span class="string">"./1.png"</span>);<span class="comment">//载入图片（类似的jpeg/gif方法）</span></span><br><span class="line"><span class="variable">$red</span> = imagecolorallocate(<span class="variable">$im</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>);<span class="comment">//设置颜色 rgb</span></span><br><span class="line">imagettftext(<span class="variable">$im</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">320</span>, <span class="number">84</span>, <span class="variable">$red</span>, <span class="variable">$font</span>, <span class="variable">$name</span>);<span class="comment">//打印水印</span></span><br><span class="line">imagepng(<span class="variable">$im</span>,<span class="string">'test2.png'</span>);<span class="comment">//输出图片,如果要保存加个保存路径和文件名</span></span><br><span class="line">imagedestroy(<span class="variable">$im</span>);<span class="comment">//释放资源</span></span><br></pre></td></tr></table></figure>
<p>然后就会发现乱码。</p>
<p>网上再查，类似$text = iconv(&#8220;GB2312&#8221;, &#8220;UTF-8&#8221;, $name);GBK啊等等，我都试过，结果一样，还是乱码。再有的说因为php文件本身的编码不是UTF8啊等等。我特意记事本，另存为<span style="font-family: Arial;">UTF-8</span><span style="font-family: 宋体;">，再</span><span style="font-family: Arial;">try</span><span style="font-family: 宋体;">，仍然乱码。还有的说加什么</span><span style="font-family: Arial;">header( &#8220;Content-Type:text/html; charset=UTF-8 &#8220;);</span><span style="font-family: 宋体;">仍然乱码。</span><span style="font-family: Arial;"><br> </span></p>
<p>还有的说用<span style="font-size: 10pt;"><span style="color: black; font-family: Courier New;">mb_convert_encoding(</span><span style="color: #660000; font-family: Courier New;">$content</span><span style="color: black; font-family: Courier New;">, </span><span style="color: #008200; font-family: Courier New;">&#8220;html-entities&#8221;</span><span style="color: black; font-family: Courier New;">,</span><span style="color: #008200; font-family: Courier New;">&#8220;utf-8&#8221; </span><span style="color: black;"><span style="font-family: Courier New;">);</span><span style="font-family: 宋体;">最后终于</span><span style="font-family: Courier New;">OK</span><span style="font-family: 宋体;">了，不过这个函数还得对应的字体库才行。不然仍然会乱码的。</span><span style="font-family: Courier New;"><br> </span></span></span></p>
<p><span style="color: black; font-family: 宋体; font-size: 10pt;">还得注意有可能会报这个错误</span>imagettftext() [function.imagettftext]: any2euc<span style="color: black;"><span style="font-family: Arial;">jp(): something happen in XXX.php on line XX</span><span style="font-family: 宋体;">。这个就是可能字库里面木有，换个字库。</span></span></p>
<p><span class="Apple-style-span" style="font-family: 宋体;">下面给出我测试的几个典型。</span></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test1</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">	<span class="variable">$content</span>=<span class="string">"唐磊leitang"</span>;</span><br><span class="line">	<span class="variable">$content</span> = mb_convert_encoding(<span class="variable">$content</span>, <span class="string">"html-entities"</span>,<span class="string">"utf-8"</span> );</span><br><span class="line">	<span class="variable">$t</span> = setTextWater(<span class="string">'./1.png'</span>,<span class="variable">$content</span>,<span class="string">"0,0,255"</span>,<span class="number">7</span>,<span class="number">18</span>);<span class="comment">//这个方法见后面</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="variable">$t</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test2</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="variable">$name</span>=<span class="string">'郁闷aaaaaa'</span>;</span><br><span class="line"><span class="variable">$name</span> = mb_convert_encoding(<span class="variable">$name</span>, <span class="string">"html-entities"</span>,<span class="string">"utf-8"</span> ); </span><br><span class="line"><span class="variable">$font</span> = <span class="string">'./simhei.ttf'</span>;<span class="comment">//水印字体   </span></span><br><span class="line"><span class="variable">$im</span> = imagecreatefrompng(<span class="string">"./1.png"</span>);<span class="comment">//载入图片   </span></span><br><span class="line"><span class="variable">$black</span> = imagecolorallocate(<span class="variable">$im</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);<span class="comment">//设置颜色   </span></span><br><span class="line">imagettftext(<span class="variable">$im</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">320</span>, <span class="number">84</span>, <span class="variable">$black</span>, <span class="variable">$font</span>, <span class="variable">$name</span>);<span class="comment">//打印水印   </span></span><br><span class="line">imagepng(<span class="variable">$im</span>,<span class="string">'test2.png'</span>); </span><br><span class="line">imagedestroy(<span class="variable">$im</span>);<span class="comment">//清空缓存  </span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//这个其实是图片水印了</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test3</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="variable">$pic</span>=imagecreate(<span class="number">250</span>,<span class="number">30</span>);</span><br><span class="line">	<span class="variable">$black</span>=imagecolorallocate(<span class="variable">$pic</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">	<span class="variable">$white</span>=imagecolorallocate(<span class="variable">$pic</span>,<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>);</span><br><span class="line">	<span class="variable">$font</span>=<span class="string">"./simhei.ttf"</span>;</span><br><span class="line">	<span class="variable">$str</span> = <span class="string">'中华人民共和国'</span>;</span><br><span class="line">	<span class="variable">$str</span> = mb_convert_encoding(<span class="variable">$str</span>, <span class="string">"html-entities"</span>,<span class="string">"utf-8"</span> );<span class="comment">//结果:&amp;#21738;&amp;#19968;&amp;#38431;&amp;#20248;&amp;#20808;&amp;#24320;&amp;#29699;</span></span><br><span class="line"></span><br><span class="line">	imagettftext(<span class="variable">$pic</span>,<span class="number">10</span>,<span class="number">0</span>,<span class="number">10</span>,<span class="number">20</span>,<span class="variable">$white</span>,<span class="variable">$font</span>,<span class="variable">$str</span>);</span><br><span class="line"></span><br><span class="line">	<span class="variable">$filename</span>=<span class="string">'./1.png'</span>;</span><br><span class="line">	<span class="variable">$im</span>=imagecreatefrompng(<span class="variable">$filename</span>);</span><br><span class="line">	imagecopymerge(<span class="variable">$im</span>,<span class="variable">$pic</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">250</span>,<span class="number">30</span>,<span class="number">50</span>);</span><br><span class="line">	imagepng(<span class="variable">$im</span>,<span class="string">'test3.png'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><span style="color: black; font-size: 10pt;"><span style="font-family: 宋体;">效果如图：</span><span style="font-family: Courier New;"><br> </span></span></p>
<p><span style="color: black; font-family: Courier New; font-size: 10pt;">Test1<br> </span></p>
<p><img src="/wp-content/uploads/2011/11/111711_1141_Php1.png" alt=""></p>
<p>Test2                                                            Test3</p>
<p><img class="alignleft" title="php中文水印乱码" src="/wp-content/uploads/2011/11/111711_1141_Php2.png" alt="php中文水印乱码" width="172" height="245"></p>
<p><img src="/wp-content/uploads/2011/11/111711_1141_Php3.png" alt=""></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>把每一次试的结果都保存了。</p>
<ul>
<li><span style="color: #660000; background-color: yellow;">$name </span><span style="color: black; background-color: yellow;">= iconv(</span><span style="color: #008200; background-color: yellow;">&#8216;UTF-8&#8217;</span><span style="color: black; background-color: yellow;">, </span><span style="color: #008200; background-color: yellow;">&#8216;GB18030//IGNORE&#8217;</span><span style="color: black; background-color: yellow;">, </span><span style="color: #660000; background-color: yellow;">$name</span><span style="color: black; background-color: yellow;">);</span></li>
</ul>
<p><img src="/wp-content/uploads/2011/11/111711_1141_Php4.png" alt=""></p>
<p>&nbsp;</p>
<ul>
<li><div style="text-align: justify;"><br>  <span style="font-family: Courier New; font-size: 10pt;"><span style="color: #660000; background-color: yellow;">$name </span><span style="color: black; background-color: yellow;">= iconv(</span><span style="color: #008200; background-color: yellow;">&#8216;UTF-8&#8217;</span><span style="color: black; background-color: yellow;">, </span><span style="color: #008200; background-color: yellow;">&#8216;GB2312&#8217;</span><span style="color: black; background-color: yellow;">, </span><span style="color: #660000; background-color: yellow;">$name</span><span style="color: black; background-color: yellow;">);<br> </span></span><br></div>

</li>
</ul>
<p><span style="font-family: Courier New; font-size: 10pt;"><span style="color: #660000; background-color: yellow;">$font</span><span style="color: black; background-color: yellow;">=</span><span style="color: #008200; background-color: yellow;">&#8220;./simhei.ttf&#8221;</span><span style="color: black; background-color: yellow;">;</span></span></p>
<p><img src="/wp-content/uploads/2011/11/111711_1141_Php5.png" alt=""></p>
<ul>
<li><span style="color: #660000; font-family: Courier New;">$name</span><span style="color: black; font-family: Courier New;">=</span><span style="color: #008200;"><span style="font-family: Courier New;">&#8216;</span><span style="font-family: 宋体;">唐磊</span><span style="font-family: Courier New;">leitang&#8217;</span></span><span style="font-family: Courier New;"><span>;</span></span></li>
</ul>
<p><span style="font-family: Courier New; font-size: 10pt;"><span style="color: #660000;">$name </span><span style="color: black;">= mb_convert_encoding(</span><span style="color: #660000;">$name</span><span style="color: black;">, </span><span style="color: #008200;">&#8220;html-entities&#8221;</span><span style="color: black;">,</span><span style="color: #008200;">&#8220;utf-8&#8221; </span><span style="color: black;">);</span><br> </span></p>
<p><span style="font-size: 10pt;"><span style="color: #660000; font-family: Courier New;">$font </span><span style="color: black; font-family: Courier New;">= </span><span style="color: #008200; font-family: Courier New;">&#8216;./arial.ttf&#8217;</span><span style="color: black; font-family: Courier New;">;</span><span style="color: gray;"><span style="font-family: Courier New;">//</span><span style="font-family: 宋体;">水印字体</span><span style="font-family: Courier New;"><br> </span></span></span></p>
<p><img src="/wp-content/uploads/2011/11/111711_1141_Php6.png" alt=""></p>
<p>&nbsp;</p>
<ul>
<li><span style="font-size: 10pt;"><span style="color: #660000; font-family: Courier New;">$name</span><span style="color: black; font-family: Courier New;">=</span><span style="color: #008200;"><span style="font-family: Courier New;">&#8216;</span><span style="font-family: 宋体;">唐磊</span><span style="font-family: Courier New;">leitang&#8217;</span></span><span style="font-family: Courier New;"><span style="color: black;">;</span><br> </span></span></li>
</ul>
<p><span style="font-family: Courier New; font-size: 10pt;"><span style="color: #660000;">$name </span><span style="color: black;">= mb_convert_encoding(</span><span style="color: #660000;">$name</span><span style="color: black;">, </span><span style="color: #008200;">&#8220;html-entities&#8221;</span><span style="color: black;">,</span><span style="color: #008200;">&#8220;utf-8&#8221; </span><span style="color: black;">);</span><br> </span></p>
<p><span style="font-size: 10pt;"><span style="color: #660000; font-family: Courier New;">$font </span><span style="color: black; font-family: Courier New;">= </span><span style="color: #008200; font-family: Courier New;">&#8216;./simhei.ttf&#8217;</span><span style="color: black; font-family: Courier New;">;</span><span style="color: gray;"><span style="font-family: Courier New;">//</span><span style="font-family: 宋体;">水印字体</span><span style="font-family: Courier New;"><br> </span></span></span></p>
<p><img src="/wp-content/uploads/2011/11/111711_1141_Php7.png" alt=""></p>
<ul>
<li><span style="color: #660000; font-family: Courier New;">$name</span><span style="color: black; font-family: Courier New;">=</span><span style="color: #008200;"><span style="font-family: Courier New;">&#8216;</span><span style="font-family: 宋体;">唐磊</span><span style="font-family: Courier New;">leitang&#8217;</span></span><span style="font-family: Courier New;"><span>;</span></span></li>
</ul>
<p><span style="font-family: Courier New; font-size: 10pt;"><span style="color: #660000;">$name </span><span style="color: black;">= mb_convert_encoding(</span><span style="color: #660000;">$name</span><span style="color: black;">, </span><span style="color: #008200;">&#8220;UTF-8&#8221;</span><span style="color: black;">, </span><span style="color: #008200;">&#8220;GBK&#8221;</span><span style="color: black;">);</span><br> </span></p>
<p><span style="font-size: 10pt;"><span style="color: #660000; font-family: Courier New;">$font </span><span style="color: black; font-family: Courier New;">= </span><span style="color: #008200; font-family: Courier New;">&#8216;./simhei.ttf&#8217;</span><span style="color: black; font-family: Courier New;">;</span><span style="color: gray;"><span style="font-family: Courier New;">//</span><span style="font-family: 宋体;">水印字体</span><span style="font-family: Courier New;"><br> </span></span></span></p>
<p><img src="/wp-content/uploads/2011/11/111711_1141_Php8.png" alt=""></p>
<p>&nbsp;</p>
<p>附上详细方法(参考网上滴)：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * 文字水印</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setTextWater</span><span class="params">(<span class="variable">$imgSrc</span>,<span class="variable">$markText</span>,<span class="variable">$TextColor</span>,<span class="variable">$markPos</span>,<span class="variable">$fontSize</span> = <span class="number">30</span>)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">	<span class="variable">$fontType</span>=<span class="string">"./simhei.ttf"</span>;</span><br><span class="line">    <span class="variable">$srcInfo</span> = @getimagesize(<span class="variable">$imgSrc</span>);</span><br><span class="line">    <span class="variable">$srcImg_w</span>    = <span class="variable">$srcInfo</span>[<span class="number">0</span>];</span><br><span class="line">    <span class="variable">$srcImg_h</span>    = <span class="variable">$srcInfo</span>[<span class="number">1</span>];</span><br><span class="line">    <span class="variable">$markText</span> = mb_convert_encoding(<span class="variable">$markText</span>, <span class="string">"html-entities"</span>,<span class="string">"utf-8"</span> );</span><br><span class="line">    <span class="variable">$markedfilename</span>=<span class="string">"tmp/"</span>.time();</span><br><span class="line">    <span class="keyword">switch</span> (<span class="variable">$srcInfo</span>[<span class="number">2</span>]) </span><br><span class="line">    &#123; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>: </span><br><span class="line">            <span class="variable">$srcim</span> =imagecreatefromgif(<span class="variable">$imgSrc</span>);</span><br><span class="line">            <span class="variable">$markedfilename</span>.=<span class="string">".gif"</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>: </span><br><span class="line">            <span class="variable">$srcim</span> =imagecreatefromjpeg(<span class="variable">$imgSrc</span>); </span><br><span class="line">            <span class="variable">$markedfilename</span>.=<span class="string">".jpg"</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>: </span><br><span class="line">            <span class="variable">$srcim</span> =imagecreatefrompng(<span class="variable">$imgSrc</span>); </span><br><span class="line">            <span class="variable">$markedfilename</span>.=<span class="string">".png"</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">default</span>: </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"不支持的图片文件类型"</span>; </span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$markText</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(!file_exists(<span class="variable">$fontType</span>))</span><br><span class="line">            &#123;</span><br><span class="line">               <span class="keyword">echo</span> <span class="string">'字体文件不存在'</span>; </span><br><span class="line">			   <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'没有水印文字'</span>; </span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">//此函数返回一个含有8个单元的数组表示文本外框的四个角，索引值含义：0代表左下角 X 位置，1代表坐下角 Y 位置，</span></span><br><span class="line">		<span class="comment">//2代表右下角 X 位置，3代表右下角 Y 位置，4代表右上角 X 位置，5代表右上角 Y 位置，6代表左上角 X 位置，7代表左上角 Y 位置</span></span><br><span class="line">		<span class="variable">$box</span> = @imagettfbbox(<span class="variable">$fontSize</span>, <span class="number">0</span>, <span class="variable">$fontType</span>,<span class="variable">$markText</span>);</span><br><span class="line">		<span class="comment">//var_dump($box);exit;</span></span><br><span class="line">        <span class="variable">$logow</span> = max(<span class="variable">$box</span>[<span class="number">2</span>], <span class="variable">$box</span>[<span class="number">4</span>]) - min(<span class="variable">$box</span>[<span class="number">0</span>], <span class="variable">$box</span>[<span class="number">6</span>]);</span><br><span class="line">        <span class="variable">$logoh</span> = max(<span class="variable">$box</span>[<span class="number">1</span>], <span class="variable">$box</span>[<span class="number">3</span>]) - min(<span class="variable">$box</span>[<span class="number">5</span>], <span class="variable">$box</span>[<span class="number">7</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">     </span><br><span class="line">    <span class="keyword">switch</span>(<span class="variable">$markPos</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            <span class="variable">$x</span> = <span class="number">5</span>;</span><br><span class="line">            <span class="variable">$y</span> = <span class="variable">$fontSize</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            <span class="variable">$x</span> = (<span class="variable">$srcImg_w</span> - <span class="variable">$logow</span>) / <span class="number">2</span>;</span><br><span class="line">            <span class="variable">$y</span> = <span class="variable">$fontSize</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">            <span class="variable">$x</span> = <span class="variable">$srcImg_w</span> - <span class="variable">$logow</span> - <span class="number">5</span>;</span><br><span class="line">            <span class="variable">$y</span> = <span class="variable">$fontSize</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">            <span class="variable">$x</span> = <span class="variable">$fontSize</span>;</span><br><span class="line">            <span class="variable">$y</span> = (<span class="variable">$srcImg_h</span> - <span class="variable">$logoh</span>) / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">            <span class="variable">$x</span> = (<span class="variable">$srcImg_w</span> - <span class="variable">$logow</span>) / <span class="number">2</span>;</span><br><span class="line">            <span class="variable">$y</span> = (<span class="variable">$srcImg_h</span> - <span class="variable">$logoh</span>) / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">            <span class="variable">$x</span> = <span class="variable">$srcImg_w</span> - <span class="variable">$logow</span> - <span class="number">5</span>;</span><br><span class="line">            <span class="variable">$y</span> = (<span class="variable">$srcImg_h</span> - <span class="variable">$logoh</span>) / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">            <span class="variable">$x</span> = <span class="variable">$fontSize</span>;</span><br><span class="line">            <span class="variable">$y</span> = <span class="variable">$srcImg_h</span> - <span class="variable">$logoh</span> - <span class="number">5</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">            <span class="variable">$x</span> = (<span class="variable">$srcImg_w</span> - <span class="variable">$logow</span>) / <span class="number">2</span>;</span><br><span class="line">            <span class="variable">$y</span> = <span class="variable">$srcImg_h</span> - <span class="variable">$logoh</span> - <span class="number">5</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">9</span>:</span><br><span class="line">            <span class="variable">$x</span> = <span class="variable">$srcImg_w</span> - <span class="variable">$logow</span> - <span class="number">5</span>;</span><br><span class="line">            <span class="variable">$y</span> = <span class="variable">$srcImg_h</span> - <span class="variable">$logoh</span> -<span class="number">5</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>: </span><br><span class="line">			<span class="variable">$x</span> = rand ( <span class="number">0</span>, (<span class="variable">$srcImg_w</span> - <span class="variable">$logow</span>) );</span><br><span class="line">			<span class="variable">$y</span> = rand ( <span class="number">0</span>, (<span class="variable">$srcImg_h</span> - <span class="variable">$logoh</span>) );</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="variable">$dst_img</span> = @imagecreatetruecolor(<span class="variable">$srcImg_w</span>, <span class="variable">$srcImg_h</span>);</span><br><span class="line">        </span><br><span class="line">    imagecopy ( <span class="variable">$dst_img</span>, <span class="variable">$srcim</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="variable">$srcImg_w</span>, <span class="variable">$srcImg_h</span>);</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$rgb</span> = explode(<span class="string">','</span>, <span class="variable">$TextColor</span>);</span><br><span class="line">      </span><br><span class="line">        <span class="variable">$color</span> = imagecolorallocate(<span class="variable">$dst_img</span>, intval(<span class="variable">$rgb</span>[<span class="number">0</span>]), intval(<span class="variable">$rgb</span>[<span class="number">1</span>]), intval(<span class="variable">$rgb</span>[<span class="number">2</span>]));</span><br><span class="line">        imagettftext(<span class="variable">$dst_img</span>, <span class="variable">$fontSize</span>, <span class="number">0</span>, <span class="variable">$x</span>, <span class="variable">$y</span>, <span class="variable">$color</span>, <span class="variable">$fontType</span>,<span class="variable">$markText</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (<span class="variable">$srcInfo</span>[<span class="number">2</span>]) </span><br><span class="line">    &#123; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            imagegif(<span class="variable">$dst_img</span>,<span class="variable">$markedfilename</span>); </span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>: </span><br><span class="line">            imagejpeg(<span class="variable">$dst_img</span>,<span class="variable">$markedfilename</span>); </span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>: </span><br><span class="line">            imagepng(<span class="variable">$dst_img</span>,<span class="variable">$markedfilename</span>); </span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>: </span><br><span class="line">            <span class="keyword">echo</span> (<span class="string">"不支持的水印图片文件类型"</span>); </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>; </span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    imagedestroy(<span class="variable">$dst_img</span>);</span><br><span class="line">    imagedestroy(<span class="variable">$srcim</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="variable">$markedfilename</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>顺便把图片水印的也贴出来：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * 图片水印</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>  <span class="title">setImgWater</span><span class="params">(<span class="variable">$imgSrc</span>,<span class="variable">$markImg</span>,<span class="variable">$markPos</span>)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="variable">$srcInfo</span> = @getimagesize(<span class="variable">$imgSrc</span>);</span><br><span class="line">    <span class="variable">$srcImg_w</span>    = <span class="variable">$srcInfo</span>[<span class="number">0</span>];</span><br><span class="line">    <span class="variable">$srcImg_h</span>    = <span class="variable">$srcInfo</span>[<span class="number">1</span>];</span><br><span class="line">    <span class="variable">$img_water</span> = <span class="string">"./waterpic"</span>;   <span class="comment">//生成的图片文件名 </span></span><br><span class="line">    <span class="keyword">switch</span> (<span class="variable">$srcInfo</span>[<span class="number">2</span>]) </span><br><span class="line">    &#123; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>: </span><br><span class="line">            <span class="variable">$srcim</span> =imagecreatefromgif(<span class="variable">$imgSrc</span>);</span><br><span class="line">			<span class="variable">$img_water</span>.=<span class="string">".gif"</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>: </span><br><span class="line">            <span class="variable">$srcim</span> =imagecreatefromjpeg(<span class="variable">$imgSrc</span>); </span><br><span class="line">			<span class="variable">$img_water</span>.=<span class="string">".jpg"</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>: </span><br><span class="line">            <span class="variable">$srcim</span> =imagecreatefrompng(<span class="variable">$imgSrc</span>); </span><br><span class="line">			<span class="variable">$img_water</span>.=<span class="string">".png"</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">default</span>: </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"不支持的图片文件类型"</span>; </span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(!file_exists(<span class="variable">$markImg</span>) || <span class="keyword">empty</span>(<span class="variable">$markImg</span>))</span><br><span class="line">        &#123;</span><br><span class="line">        	<span class="keyword">echo</span> <span class="string">'水印文件不存在'</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">            </span><br><span class="line">        <span class="variable">$markImgInfo</span> = @getimagesize(<span class="variable">$markImg</span>);</span><br><span class="line">        <span class="variable">$markImg_w</span>    = <span class="variable">$markImgInfo</span>[<span class="number">0</span>];</span><br><span class="line">        <span class="variable">$markImg_h</span>    = <span class="variable">$markImgInfo</span>[<span class="number">1</span>];</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$srcImg_w</span> &lt; <span class="variable">$markImg_w</span> || <span class="variable">$srcImg_h</span> &lt; <span class="variable">$markImg_h</span>)</span><br><span class="line">        &#123;</span><br><span class="line">        	<span class="keyword">echo</span> <span class="string">'水印文件比源图片文件都还大'</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">switch</span> (<span class="variable">$markImgInfo</span>[<span class="number">2</span>]) </span><br><span class="line">        &#123; </span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>: </span><br><span class="line">                <span class="variable">$markim</span> =imagecreatefromgif(<span class="variable">$markImg</span>); </span><br><span class="line">                <span class="keyword">break</span>; </span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>: </span><br><span class="line">                <span class="variable">$markim</span> =imagecreatefromjpeg(<span class="variable">$markImg</span>); </span><br><span class="line">                <span class="keyword">break</span>; </span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>: </span><br><span class="line">                <span class="variable">$markim</span> =imagecreatefrompng(<span class="variable">$markImg</span>); </span><br><span class="line">                <span class="keyword">break</span>; </span><br><span class="line">            <span class="keyword">default</span>: </span><br><span class="line">                <span class="keyword">echo</span> (<span class="string">"不支持的水印图片文件类型"</span>); </span><br><span class="line">            	<span class="keyword">return</span> <span class="keyword">false</span>; </span><br><span class="line">        &#125;</span><br><span class="line">            </span><br><span class="line">        <span class="variable">$logow</span> = <span class="variable">$markImg_w</span>;</span><br><span class="line">        <span class="variable">$logoh</span> = <span class="variable">$markImg_h</span>;</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">     </span><br><span class="line">    <span class="keyword">switch</span>(<span class="variable">$markPos</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            <span class="variable">$x</span> = <span class="number">5</span>;</span><br><span class="line">            <span class="variable">$y</span> = <span class="number">5</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            <span class="variable">$x</span> = (<span class="variable">$srcImg_w</span> - <span class="variable">$logow</span>) / <span class="number">2</span>;</span><br><span class="line">            <span class="variable">$y</span> = <span class="number">5</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">            <span class="variable">$x</span> = <span class="variable">$srcImg_w</span> - <span class="variable">$logow</span> - <span class="number">5</span>;</span><br><span class="line">            <span class="variable">$y</span> = <span class="number">5</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">            <span class="variable">$x</span> = <span class="number">5</span>;</span><br><span class="line">            <span class="variable">$y</span> = (<span class="variable">$srcImg_h</span> - <span class="variable">$logoh</span>) / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">            <span class="variable">$x</span> = (<span class="variable">$srcImg_w</span> - <span class="variable">$logow</span>) / <span class="number">2</span>;</span><br><span class="line">            <span class="variable">$y</span> = (<span class="variable">$srcImg_h</span> - <span class="variable">$logoh</span>) / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">            <span class="variable">$x</span> = <span class="variable">$srcImg_w</span> - <span class="variable">$logow</span> - <span class="number">5</span>;</span><br><span class="line">            <span class="variable">$y</span> = (<span class="variable">$srcImg_h</span> - <span class="variable">$logoh</span>) / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">            <span class="variable">$x</span> = <span class="number">5</span>;</span><br><span class="line">            <span class="variable">$y</span> = <span class="variable">$srcImg_h</span> - <span class="variable">$logoh</span> - <span class="number">5</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">            <span class="variable">$x</span> = (<span class="variable">$srcImg_w</span> - <span class="variable">$logow</span>) / <span class="number">2</span>;</span><br><span class="line">            <span class="variable">$y</span> = <span class="variable">$srcImg_h</span> - <span class="variable">$logoh</span> - <span class="number">5</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">9</span>:</span><br><span class="line">            <span class="variable">$x</span> = <span class="variable">$srcImg_w</span> - <span class="variable">$logow</span> - <span class="number">5</span>;</span><br><span class="line">            <span class="variable">$y</span> = <span class="variable">$srcImg_h</span> - <span class="variable">$logoh</span> -<span class="number">5</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>: </span><br><span class="line">			<span class="variable">$x</span> = rand ( <span class="number">0</span>, (<span class="variable">$srcImg_w</span> - <span class="variable">$logow</span>) );</span><br><span class="line">			<span class="variable">$y</span> = rand ( <span class="number">0</span>, (<span class="variable">$srcImg_h</span> - <span class="variable">$logoh</span>) );</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="variable">$dst_img</span> = @imagecreatetruecolor(<span class="variable">$srcImg_w</span>, <span class="variable">$srcImg_h</span>);</span><br><span class="line">        </span><br><span class="line">    imagecopy ( <span class="variable">$dst_img</span>, <span class="variable">$srcim</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="variable">$srcImg_w</span>, <span class="variable">$srcImg_h</span>);</span><br><span class="line">        </span><br><span class="line">    &#123;</span><br><span class="line">        imagecopy(<span class="variable">$dst_img</span>, <span class="variable">$markim</span>, <span class="variable">$x</span>, <span class="variable">$y</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="variable">$logow</span>, <span class="variable">$logoh</span>);</span><br><span class="line">        imagedestroy(<span class="variable">$markim</span>);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">switch</span> (<span class="variable">$srcInfo</span>[<span class="number">2</span>]) </span><br><span class="line">    &#123; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            imagegif(<span class="variable">$dst_img</span>, <span class="variable">$img_water</span> ); </span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>: </span><br><span class="line">            imagejpeg(<span class="variable">$dst_img</span>, <span class="variable">$img_water</span> ); </span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>: </span><br><span class="line">            imagepng(<span class="variable">$dst_img</span>, <span class="variable">$img_water</span> ); </span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>: </span><br><span class="line">            <span class="keyword">echo</span> (<span class="string">"不支持的水印图片文件类型"</span>); </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>; </span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    imagedestroy(<span class="variable">$dst_img</span>);</span><br><span class="line">    imagedestroy(<span class="variable">$srcim</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'success,the watermarked picture is '</span>.<span class="variable">$img_water</span>.<span class="string">"\n"</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>btw,codecolorer这个插件的那个bug还没解决啊。后台写blog时，只要切换一下html到可视化，代码缩进就木有了……</p>
</div><div class="tags"><a href="/tags/PHP/">PHP</a><a href="/tags/php中文图片水印/">php中文图片水印</a><a href="/tags/php中文水印乱码/">php中文水印乱码</a><a href="/tags/php文字水印乱码/">php文字水印乱码</a></div><div class="post-nav"><a href="/blog/intern-in-tencent-to-be-a-sad-programmer.html" class="pre"><i class="icon-previous">感受到了做程序员的苦逼</i></a><a href="/blog/qq-mobile-secure-manager-feedback.html" class="next">坑爹的QQ手机管家【续】<i class="icon-next"></i></a></div><div id="disqus_thread"><script>var disqus_shortname = 'hexo-tanglei';
var disqus_identifier = 'blog/add-chinese-text-mark-to-picture-in-php.html';
var disqus_title = 'php图片加文字水印(中文乱码解法方案)';
var disqus_url = 'http://www.tanglei.name/blog/add-chinese-text-mark-to-picture-in-php.html';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//hexo-tanglei.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="search" name="word" maxlength="20" placeholder="Search" class="search-form-input"/><input type="hidden" name="si" value="http://www.tanglei.name"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="widget-title">分类</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA/">JAVA</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-amp-Ubuntu/">Linux&amp;Ubuntu</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MyLife/">MyLife</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/SoftwareEngineering/">SoftwareEngineering</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Windows/">Windows</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/android/">android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/c/">c++</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/coding小工具/">coding小工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/wordpress/">wordpress</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/业界动态/">业界动态</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/名人名事/">名人名事</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/实习那些事儿/">实习那些事儿</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作那些事儿/">工作那些事儿</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/开开眼界/">开开眼界</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/我不会算法/">我不会算法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/我做站长/">我做站长</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库应用/">数据库应用</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据挖掘/">数据挖掘</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/敲敲代码/">敲敲代码</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/清华大学/">清华大学</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/玩玩手机/">玩玩手机</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/移动领域/">移动领域</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/经验技巧/">经验技巧</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络文摘/">网络文摘</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机图形学/">计算机图形学</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/贵州支教行/">贵州支教行</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/软件0804/">软件0804</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/软件体系结构/">软件体系结构</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/软件学院/">软件学院</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/软件工程/">软件工程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/软件度量及其应用/">软件度量及其应用</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/软件配置管理/">软件配置管理</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/软件项目管理/">软件项目管理</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/软考/">软考</a></li></ul></div><div class="widget"><div class="widget-title">最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/blog/jquery-ajax-post-to-download-a-file.html">jQuery Ajax请求下载文件资源</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/travel-to-northwest-of-China.html">毕业旅行之大西北游</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/codecolorer-adapted-to-highlight.html">将代码高亮插件codecolorer替换为highlight</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/binding-domain-to-plugin-of-mobile-theme.html">给手机主题插件Wptouch绑定单独的域名</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/share-beamer-with-tsinghua-theme.html">分享一个清华主题的beamer模版</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/install-vim-latex-suite-in-mac-osx.html">Mac下安装使用vim插件latex-suite</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/travel-to-vietnam.html">越南10日游记</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/summary-of-year-2014.html">2014年终总结</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/android-airplanemode-auto-switcher-v2.html">飞行模式助手</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/leetcode-summary.html">leetcode总结</a></li></ul></div><div class="widget"><div class="widget-title">最近评论</div><script type="text/javascript" src="//hexo-tanglei.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title">友情链接</div><ul></ul><a href="http://wordpress.tanglei.name/" title="我的wordpress博客" target="_blank">我的wordpress博客</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div></div><div id="footer">© <a href="/." rel="nofollow">tanglei's blog|唐磊的个人博客.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/jquery.min.js?v=0.0.0"></script><script type="text/javascript" src="/js/totop.js?v=0.0.0"></script><script type="text/javascript" src="/js/fancybox.pack.js?v=0.0.0"></script><script type="text/javascript" src="/js/jquery.fancybox.js?v=0.0.0"></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>