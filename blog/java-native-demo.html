<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="中南大学|清华大学软件学院唐磊的博客,主攻软件工程,数据挖掘,这里记录了我的学习，生活和工作"><title>java native例子 | tanglei's blog|唐磊的个人博客</title><link rel="stylesheet" type="text/css" href="/css/normalize.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/pure-min.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">java native例子</h1><a id="logo" href="/.">tanglei's blog|唐磊的个人博客</a><p class="description">记录我的学习、生活、工作。</p></div><div id="nav-menu"><a href="/." class="current"><i class="icon-home"> 首页</i></a><a href="/archives/"><i class="icon-archive"> 归档</i></a><a href="/blog/about.html"><i class="icon-about"> 关于</i></a><a href="/atom.xml"><i class="icon-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post post-page"><h1 class="post-title">java native例子</h1><div class="post-meta">2010-12-21 | <span class="categories">分类于<a href="/categories/JAVA/"> JAVA</a></span></div><span data-disqus-identifier="blog/java-native-demo.html" class="disqus-comment-count"></span><div class="post-content"><p>研究了下java native方法的例子。网上看了下资料。</p>
<p>首先看下什么是Native method，参考了下<a href="http://www.80&#215;86.cn/article.asp?id=1448上的文章" target="_blank" rel="external">http://www.80&#215;86.cn/article.asp?id=1448上的文章</a></p>
<p>Simply put, a native method is the Java interface to non-Java code. It is Java&#8217;s link to the &#8220;outside world.&#8221; More specifically, a native method is a Java method whose implementation is provided by non-Java code, most likely C。大概意思就是说native方法是通过java调用其他非java的代码。</p>
<p>in your Java class, you mark the methods you wish to implement outside of Java with the native method modifier-much like you would use the public or static modifiers. Then, rather than supplying the method&#8217;s body, you simply place a semicolon in its place.The only thing special about this declaration is that the keyword native is used as a modifier. Every other Java method modifier can be used along with native, except abstract.说的是native关键字跟其他什么public static修饰符一样也可以用来修饰方法。但除了abstract。This is logical, because the native modifier implies that an implementation exists, and the abstract modifier insists that there is no implementation. Your native methods can be static methods, thus not requiring the creation of an object (or instance of a class).这是合理的，因为native暗示这些方法是有实现体的，只不过这些实现体是非java的，但是abstract却显然的指明这些方法无实现体。呵呵。我就不翻译原文了。有兴趣的看看原文去吧。</p>
<p>再查了些资料，就写了如下的代码。这个代码又是helloworld。唉，继续helloworld吧。用java去调用一个用C实现的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* project_name：nativeTest</span><br><span class="line">*  Description:</span><br><span class="line">*  Copyright: Copyright (c) 2010 by tl3shi.</span><br><span class="line">**/</span></span><br><span class="line"><span class="keyword">package</span> com.i3zhai.www;</span><br><span class="line"><span class="comment">/**</span><br><span class="line">*  Title: NativeHelloWorld.java</span><br><span class="line">*  Description:测试java关键字中native的方法</span><br><span class="line">* <span class="doctag">@author</span> ： &lt;a href="mailto:tanglei3shi@163.com"&gt;tl3shi&lt;/a&gt;</span><br><span class="line">* <span class="doctag">@date</span>：2010-12-21 下午10:23:24</span><br><span class="line">* <span class="doctag">@version</span> 1.0</span><br><span class="line">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NativeHelloWorld</span></span><br><span class="line"></span>&#123;</span><br><span class="line"><span class="comment">/**</span><br><span class="line">* tl3shi</span><br><span class="line">* 下午10:27:23</span><br><span class="line">* Discription: 构造方法，加载dll文件</span><br><span class="line">* 或者用static 引入dll文件也可以，总之就是要在</span><br><span class="line">* 程序用到的时候之前把dll加载进来</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">NativeHelloWorld</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">System.loadLibrary(<span class="string">"hello"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* tl3shi</span><br><span class="line">* 下午10:28:24</span><br><span class="line">* Discription:声明一个native的方法</span><br><span class="line">* 因为是native的 只是声明，实现由另外的诸如C语言去实现</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">nativeHello</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">/**</span><br><span class="line">* tl3shi</span><br><span class="line">* 下午10:28:59</span><br><span class="line">* Discription:在此类中去调用C语言中实现的方法</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">nativeHello();<span class="comment">//调用方法</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面已经写好了注释了。刚开始的时候，我直接用了eclipse，但发现后来dll文件容易找不到(eclipse估计估计还得哪里配置下吧)。于是就改为控制台下。</p>
<p>首先用javac命令 编译出class文件。没有编译错误就会产生class文件。</p>
<p>然后执行javah命令。看javah 的用法。直接控制台下就能看到</p>
<p>R:\native&gt;javah</p>
<p>用法：javah [选项] &lt;类&gt;</p>
<p>其中 [选项] 包括：</p>
<p>-help 输出此帮助消息并退出</p>
<p>-classpath &lt;路径&gt; 用于装入类的路径</p>
<p>-bootclasspath &lt;路径&gt; 用于装入引导类的路径</p>
<p>-d &lt;目录&gt; 输出目录</p>
<p>-o &lt;文件&gt; 输出文件（只能使用 -d 或 -o 中的一个）</p>
<p>-jni 生成 JNI样式的头文件（默认）</p>
<p>-version 输出版本信息</p>
<p>-verbose 启用详细输出</p>
<p>-force 始终写入输出文件</p>
<p>使用全限定名称指定 &lt;类&gt;（例</p>
<p>如，java.lang.Object）。</p>
<p>直接用javah NativeHelloWorld 就会生成一个.h的文件。如下所示：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* DO NOT EDIT THIS FILE - it is machine generated */</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span></span></span><br><span class="line"><span class="comment">/* Header for class NativeHelloWorld */</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">ifndef</span> _Included_NativeHelloWorld</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> _Included_NativeHelloWorld</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> &#123;</span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="comment">/*</span><br><span class="line">* Class:     NativeHelloWorld</span><br><span class="line">* Method:    nativeHello</span><br><span class="line">* Signature: ()V</span><br><span class="line">*/</span></span><br><span class="line"><span class="function">JNIEXPORT <span class="keyword">void</span> JNICALL <span class="title">Java_NativeHelloWorld_nativeHello</span></span><br><span class="line"><span class="params">(JNIEnv * xx, jobject xxx)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<p style="text-align: center;"><br>  然后在写hello。c文件如下所示：<br></p>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">"NativeHelloWorld.h"</span></span></span><br><span class="line"><span class="function">JNIEXPORT <span class="keyword">void</span> JNICALL <span class="title">Java_NativeHelloWorld_nativeHello</span></span><br><span class="line"><span class="params">(JNIEnv * xx, jobject xxx)</span></span><br><span class="line"></span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"helloWorld,I am printing in the C "</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>JNIEXPORT void JNICALL Java_NativeHelloWorld_nativeHello直接copy头文件里面的就是了，</p>
<p>接下来要做的就是要生成dll文件。这个dll文件就是在类NativeHelloWorld中要load的参数名字。生成dll文件可以用VC6.0之类的工具。期间在build的时候可能会遇到问题。就是上面的方法签名的地方需要加上参数。如上面的XX,xxx。这个是后来加上去的，不是javah之后就有的.</p>
<p>在build的时候，跟着错误信息就知道了，还会用到其他的dll文件。这个文件到jdk安装目录下search下就OK了。有jni.h,其中jni.h又会用到jni_md.h。直接copy过来到VC的工作路径下。然后就能在debug目录里面找到dll文件了。</p>
<p>此时，已经差不多了。再写个Test就OK了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* Title: NativeHelloWorld.java</span><br><span class="line">* Description:测试java关键字中native的方法</span><br><span class="line">* <span class="doctag">@author</span> ： &lt;a href="mailto:tanglei3shi@163.com"&gt;tl3shi&lt;/a&gt;</span><br><span class="line">* <span class="doctag">@date</span>：2010-12-21 下午10:23:24</span><br><span class="line">* <span class="doctag">@version</span> 1.0</span><br><span class="line">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span></span><br><span class="line"></span>&#123;</span><br><span class="line"><span class="comment">/**</span><br><span class="line">* tl3shi</span><br><span class="line">* 下午10:23:24</span><br><span class="line">* Discription:</span><br><span class="line">*<span class="doctag">@param</span> args</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">NativeHelloWorld nat = <span class="keyword">new</span> NativeHelloWorld();</span><br><span class="line">nat.sayHello();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再在控制台下执行javac Test.java java Test就能看到结果了。</p>
<p><a href="/wp-content/uploads/2010/12/native1.png"><img class="size-full wp-image-125 aligncenter" title="native" src="/wp-content/uploads/2010/12/native1.png" alt="" width="339" height="163"></a></p>
<p><a href="/wp-content/uploads/2010/12/native.zip"></a></p>
<p><a href="/wp-content/uploads/2010/12/native.zip">文章例子中的源代码SRC下载</a></p>
</div><div class="tags"><a href="/tags/java/">java</a><a href="/tags/java基础/">java基础</a><a href="/tags/native/">native</a></div><div class="post-nav"><a href="/blog/happy-12-22.html" class="pre"><i class="icon-previous">Happy!</i></a><a href="/blog/exam_j2ee.html" class="next">J2EE考试有感<i class="icon-next"></i></a></div><div id="disqus_thread"><script>var disqus_shortname = 'hexo-tanglei';
var disqus_identifier = 'blog/java-native-demo.html';
var disqus_title = 'java native例子';
var disqus_url = 'http://www.tanglei.name/blog/java-native-demo.html';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//hexo-tanglei.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="search" name="word" maxlength="20" placeholder="Search" class="search-form-input"/><input type="hidden" name="si" value="http://www.tanglei.name"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="widget-title">分类</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA/">JAVA</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-amp-Ubuntu/">Linux&amp;Ubuntu</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MyLife/">MyLife</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/SoftwareEngineering/">SoftwareEngineering</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Windows/">Windows</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/android/">android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/c/">c++</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/coding小工具/">coding小工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/wordpress/">wordpress</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/业界动态/">业界动态</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/名人名事/">名人名事</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/实习那些事儿/">实习那些事儿</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作那些事儿/">工作那些事儿</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/开开眼界/">开开眼界</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/我不会算法/">我不会算法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/我做站长/">我做站长</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库应用/">数据库应用</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据挖掘/">数据挖掘</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/敲敲代码/">敲敲代码</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/清华大学/">清华大学</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/玩玩手机/">玩玩手机</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/移动领域/">移动领域</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/经验技巧/">经验技巧</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络文摘/">网络文摘</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机图形学/">计算机图形学</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/贵州支教行/">贵州支教行</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/软件0804/">软件0804</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/软件体系结构/">软件体系结构</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/软件学院/">软件学院</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/软件工程/">软件工程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/软件度量及其应用/">软件度量及其应用</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/软件配置管理/">软件配置管理</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/软件项目管理/">软件项目管理</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/软考/">软考</a></li></ul></div><div class="widget"><div class="widget-title">最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/blog/jquery-ajax-post-to-download-a-file.html">jQuery Ajax请求下载文件资源</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/travel-to-northwest-of-China.html">毕业旅行之大西北游</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/codecolorer-adapted-to-highlight.html">将代码高亮插件codecolorer替换为highlight</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/binding-domain-to-plugin-of-mobile-theme.html">给手机主题插件Wptouch绑定单独的域名</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/share-beamer-with-tsinghua-theme.html">分享一个清华主题的beamer模版</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/install-vim-latex-suite-in-mac-osx.html">Mac下安装使用vim插件latex-suite</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/travel-to-vietnam.html">越南10日游记</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/summary-of-year-2014.html">2014年终总结</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/android-airplanemode-auto-switcher-v2.html">飞行模式助手</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/leetcode-summary.html">leetcode总结</a></li></ul></div><div class="widget"><div class="widget-title">最近评论</div><script type="text/javascript" src="//hexo-tanglei.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title">友情链接</div><ul></ul><a href="http://wordpress.tanglei.name/" title="我的wordpress博客" target="_blank">我的wordpress博客</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div></div><div id="footer">© <a href="/." rel="nofollow">tanglei's blog|唐磊的个人博客.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/jquery.min.js?v=0.0.0"></script><script type="text/javascript" src="/js/totop.js?v=0.0.0"></script><script type="text/javascript" src="/js/fancybox.pack.js?v=0.0.0"></script><script type="text/javascript" src="/js/jquery.fancybox.js?v=0.0.0"></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>